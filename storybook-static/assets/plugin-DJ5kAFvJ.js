import{j as c}from"./jsx-runtime-DWbWqHZ-.js";import{r as s}from"./index-l2PZgWEW.js";const b=e=>{const i=[],n=r=>{var l;if(i.push({...r,is_incremental:!!r.is_incremental,relations:((l=r.relations)==null?void 0:l.map(a=>a.name))||[]}),r.relations)for(const a of r.relations)n(a)};for(const r of e)n(r);return i},o={no_component:"PluginConfig step sections must have a `component` property",no_title:"PluginConfig step sections must have a `title` property",no_children:"PluginConfig step sections must have a `children` property",no_name:"PluginConfig step sections components must have a `name` property. It is used as a unique identifier for the yup form validation.",no_label:"PluginConfig step sections components must have a `label` property. It is used as a display label for the form field.",no_schema:"PluginConfig step sections components must have a `schema` property. It is used as a definition of the yup schema validation for the form field.",config_no_name:"Please provide a PluginConfig `name` to the PluginContextProvider",config_no_config:"Please provide a PluginConfig to the PluginContextProvider",config_no_type:"Only `source` and `destination` are valid PluginConfig types.",config_no_label:"Please provide a PluginConfig `label` to the PluginContextProvider",config_no_docs:"Please provide a PluginConfig `docsLink` to the PluginContextProvider. Example: `https://hub.cloudquery.io/plugins/destination/cloudquery/mysql/latest/docs`",config_no_icon:"Please provide a PluginConfig `iconLink` to the PluginContextProvider. Example: `images/logo.webp`",config_no_steps:"Please provide a PluginConfig `steps` to the PluginContextProvider as an array of `Sections`. Steps are responsible for the React layout of your form, as well as form validation.",config_bad_state_schema:"stateSchema is optional. But they can only be an object of string-keyed yup.AnySchema.",config_no_auth:"Please provide a PluginConfig `auth` to the PluginContextProvider. Options are [AuthType.OAUTH, AuthType.OTHER]. An array with both values is acceptable.",config_no_guide:"Please provide a PluginConfig `guide` to the PluginContextProvider.",config_bad_error_codes:"Error codes are optional. But they can only be an object of string-keyed strings.",reserved_name:"This is a reserved name. Please use a different identifier for your form field",duplicate_names:"These form field names have been defined more than once. Form field names can only be used a single time."},y=["tables","displayName","name","connectorId","_secretKeys","_editMode","_step"],P=e=>["collapsible-section","section"].includes(e),E=e=>["control-table-selector","control-oauth"].includes(e),C=e=>!["control-exclusive-toggle","control-services-selector"].includes(e);function w(e){return e.filter((i,n,r)=>r.indexOf(i)!==n)}function u(e){const i=[];if(typeof e=="function")return[];if(!e.component)throw new Error(o.no_component);if(typeof e.component=="function")return[];if(e.component.includes("section")){const n=e;if(P(e.component)&&!n.title)throw new Error(`${o.no_title}: ${JSON.stringify(n)}`);if(!n.children)throw new Error(`${o.no_children}: ${JSON.stringify(n)}`);i.push(...n.children.flatMap(r=>u(r)))}if(e.component.includes("control")&&!E(e.component)){const n=e;if(!n.name)throw new Error(`${o.no_name}: ${JSON.stringify(n)}`);if(y.includes(n.name))throw new Error(`${o.reserved_name}: ${n.name}`);if(i.push(n.name),C(n.component)&&!n.label)throw new Error(`${o.no_label}: ${JSON.stringify(n)}`);if(!n.schema)throw new Error(`${o.no_schema}: ${JSON.stringify(n)}`)}return i.flat()}function v(e){if(!Array.isArray(e))throw new TypeError(o.config_no_steps);return e.flatMap((i,n)=>{if(!i.children||!Array.isArray(i.children))throw new Error(`${o.no_children}: Step ${n}`);return i.children.flatMap(r=>u(r))})}function T(e){if(!e)throw new Error(o.config_no_config);if(!e.name)throw new Error(o.config_no_name);if(!["source","destination"].includes(e.type))throw new Error(o.config_no_type);if(!e.label)throw new Error(o.config_no_label);if(!e.docsLink)throw new Error(o.config_no_docs);if(!e.iconLink)throw new Error(o.config_no_icon);if(!e.steps)throw new Error(o.config_no_steps);if(e.stateSchema&&typeof e.stateSchema!="object")throw new Error(o.config_bad_state_schema);if(!e.auth)throw new Error(o.config_no_auth);if(!e.guide)throw new Error(o.config_no_guide);if(e.errorCodes&&typeof e.errorCodes!="object")throw new Error(o.config_bad_error_codes);const i=v(e.steps),n=w(i);if(n.length>0)throw new Error(`${o.duplicate_names}: ${n}`);return e}var t={NVM_INC:"/Users/chrisduflo/.nvm/versions/node/v20.13.1/include/node",TERM_PROGRAM:"iTerm.app",NODE:"/opt/homebrew/Cellar/node/22.4.1/bin/node",INIT_CWD:"/Users/chrisduflo/plugin-config-ui-lib",NVM_CD_FLAGS:"-q",TERM:"xterm-256color",SHELL:"/bin/zsh",HOMEBREW_REPOSITORY:"/opt/homebrew",TMPDIR:"/var/folders/tz/qbjfnvv97xx5w78r61s9c4yw0000gn/T/",npm_config_global_prefix:"/opt/homebrew",TERM_PROGRAM_VERSION:"3.5.3",COLOR:"1",TERM_SESSION_ID:"w0t0p3:2AC9EFFB-C920-41F7-8307-804234D6298C",npm_config_noproxy:"",npm_config_local_prefix:"/Users/chrisduflo/plugin-config-ui-lib",NVM_DIR:"/Users/chrisduflo/.nvm",USER:"chrisduflo",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/opt/homebrew/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.bbME9SIxYT/Listeners",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/opt/homebrew/lib/node_modules/npm/bin/npm-cli.js",TERM_FEATURES:"T3LrMSc7UUw9Ts3BFGsSyHNoSxF",TERMINFO_DIRS:"/Applications/iTerm.app/Contents/Resources/terminfo:/usr/share/terminfo",PATH:"/Users/chrisduflo/plugin-config-ui-lib/node_modules/.bin:/Users/chrisduflo/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/opt/homebrew/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/opt/homebrew/bin:/opt/homebrew/sbin:/Users/chrisduflo/.nvm/versions/node/v20.13.1/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/usr/local/go/bin:/Applications/iTerm.app/Contents/Resources/utilities",npm_package_json:"/Users/chrisduflo/plugin-config-ui-lib/package.json",_:"/Users/chrisduflo/plugin-config-ui-lib/node_modules/.bin/storybook",LaunchInstanceID:"C7016EC4-7A6B-4263-A6C1-AFE2910CF274",npm_config_userconfig:"/Users/chrisduflo/.npmrc",npm_config_init_module:"/Users/chrisduflo/.npm-init.js",__CFBundleIdentifier:"com.googlecode.iterm2",npm_command:"run-script",PWD:"/Users/chrisduflo/plugin-config-ui-lib",npm_lifecycle_event:"build-storybook",EDITOR:"vi",npm_package_name:"@cloudquery/plugin-config-ui-lib",LANG:"en_US.UTF-8",ITERM_PROFILE:"Default",npm_config_npm_version:"10.8.1",XPC_FLAGS:"0x0",npm_config_node_gyp:"/opt/homebrew/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"3.0.2",XPC_SERVICE_NAME:"0",SHLVL:"2",HOME:"/Users/chrisduflo",COLORFGBG:"15;0",LC_TERMINAL_VERSION:"3.5.3",HOMEBREW_PREFIX:"/opt/homebrew",ITERM_SESSION_ID:"w0t0p3:2AC9EFFB-C920-41F7-8307-804234D6298C",npm_config_cache:"/Users/chrisduflo/.npm",LOGNAME:"chrisduflo",npm_lifecycle_script:"storybook build",NVM_BIN:"/Users/chrisduflo/.nvm/versions/node/v20.13.1/bin",npm_config_user_agent:"npm/10.8.1 node/v22.4.1 darwin arm64 workspaces/false",INFOPATH:"/opt/homebrew/share/info:/opt/homebrew/share/info:",HOMEBREW_CELLAR:"/opt/homebrew/Cellar",LC_TERMINAL:"iTerm2",SECURITYSESSIONID:"186b5",npm_node_execpath:"/opt/homebrew/Cellar/node/22.4.1/bin/node",npm_config_prefix:"/opt/homebrew",COLORTERM:"truecolor",NODE_ENV:"production"};function R(){if(!t.REACT_APP_PLUGIN_TEAM||!t.REACT_APP_PLUGIN_KIND||!t.REACT_APP_PLUGIN_NAME||!t.REACT_APP_PLUGIN_VERSION)throw new Error("Plugin environment variables are not set");return{team:t.REACT_APP_PLUGIN_TEAM,kind:t.REACT_APP_PLUGIN_KIND,name:t.REACT_APP_PLUGIN_NAME,version:t.REACT_APP_PLUGIN_VERSION}}const p=s.createContext({config:{name:"",type:"source",label:"",docsLink:"",iconLink:"",steps:[],auth:[],stateSchema:void 0,guide:()=>c.jsx(c.Fragment,{}),errorCodes:{}},plugin:{name:"",kind:"",version:"",team:""},teamName:"",hideStepper:!1,tablesList:void 0,pluginUiMessageHandler:void 0,initialValues:void 0}),I=()=>s.useContext(p),N=({children:e,config:i,teamName:n,getTablesData:r,hideStepper:l,pluginUiMessageHandler:a,initialValues:d})=>{const[m,_]=s.useState();s.useEffect(()=>{r==null||r().then(({default:h})=>{_(b(h))})},[r]);const f=s.useMemo(()=>T(i),[i]),g=s.useMemo(()=>R(),[]);return c.jsx(p.Provider,{value:{config:f,plugin:g,teamName:n,tablesList:m,hideStepper:l,pluginUiMessageHandler:a,initialValues:d},children:e})};N.__docgenInfo={description:`Provider for shared/static plugin context.

@public`,methods:[],displayName:"PluginContextProvider",props:{config:{required:!0,tsType:{name:"PluginConfig"},description:""},teamName:{required:!0,tsType:{name:"string"},description:""},getTablesData:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<{ default: CloudQueryTables }>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"signature",type:"object",raw:"{ default: CloudQueryTables }",signature:{properties:[{key:"default",value:{name:"Array",elements:[{name:"CloudQueryTable"}],raw:"CloudQueryTable[]",required:!0}}]}}],raw:"Promise<{ default: CloudQueryTables }>"}}},description:""},hideStepper:{required:!0,tsType:{name:"boolean"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},pluginUiMessageHandler:{required:!0,tsType:{name:"any"},description:""},initialValues:{required:!1,tsType:{name:"union",raw:"FormMessagePayload['init']['initialValues'] | undefined",elements:[{name:"FormMessagePayload['init']['initialValues']",raw:"FormMessagePayload['init']['initialValues']"},{name:"undefined"}]},description:""}}};export{N as P,I as u};
