import{j as u}from"./jsx-runtime-DWbWqHZ-.js";import{r as i}from"./index-l2PZgWEW.js";const P=e=>{const r=[],n=t=>{var s;if(r.push({...t,is_incremental:!!t.is_incremental,relations:((s=t.relations)==null?void 0:s.map(a=>a.name))||[]}),t.relations)for(const a of t.relations)n(a)};for(const t of e)n(t);return r},o={no_component:"PluginConfig step sections must have a `component` property",no_title:"PluginConfig step sections must have a `title` property",no_children:"PluginConfig step sections must have a `children` property",no_name:"PluginConfig step sections components must have a `name` property. It is used as a unique identifier for the yup form validation.",no_label:"PluginConfig step sections components must have a `label` property. It is used as a display label for the form field.",no_schema:"PluginConfig step sections components must have a `schema` property. It is used as a definition of the yup schema validation for the form field.",config_no_name:"Please provide a PluginConfig `name` to the PluginContextProvider",config_no_config:"Please provide a PluginConfig to the PluginContextProvider",config_no_type:"Only `source` and `destination` are valid PluginConfig types.",config_no_label:"Please provide a PluginConfig `label` to the PluginContextProvider",config_no_docs:"Please provide a PluginConfig `docsLink` to the PluginContextProvider. Example: `https://hub.cloudquery.io/plugins/destination/cloudquery/mysql/latest/docs`",config_no_icon:"Please provide a PluginConfig `iconLink` to the PluginContextProvider. Example: `images/logo.webp`",config_no_steps:"Please provide a PluginConfig `steps` to the PluginContextProvider as an array of `Sections`. Steps are responsible for the React layout of your form, as well as form validation.",config_bad_state_schema:"stateSchema is optional. But they can only be an object of string-keyed yup.AnySchema.",config_no_auth:"Please provide a PluginConfig `auth` to the PluginContextProvider. Options are [AuthType.OAUTH, AuthType.OTHER]. An array with both values is acceptable.",config_no_guide:"Please provide a PluginConfig `guide` to the PluginContextProvider.",config_bad_error_codes:"Error codes are optional. But they can only be an object of string-keyed strings.",reserved_name:"This is a reserved name. Please use a different identifier for your form field",duplicate_names:"These form field names have been defined more than once. Form field names can only be used a single time."},y=["tables","displayName","name","connectorId","_secretKeys","_editMode","_step"],C=e=>["collapsible-section","section"].includes(e),v=e=>["control-table-selector","control-oauth"].includes(e),w=e=>!["control-exclusive-toggle","control-services-selector"].includes(e);function E(e){return e.filter((r,n,t)=>t.indexOf(r)!==n)}function c(e){const r=[];if(typeof e=="function")return[];if(!e.component)throw new Error(o.no_component);if(typeof e.component=="function")return[];if(e.component.includes("section")){const n=e;if(C(e.component)&&!n.title)throw new Error(`${o.no_title}: ${JSON.stringify(n)}`);if(!n.children)throw new Error(`${o.no_children}: ${JSON.stringify(n)}`);r.push(...n.children.flatMap(t=>c(t)))}if(e.component.includes("control")&&!v(e.component)){const n=e;if(!n.name)throw new Error(`${o.no_name}: ${JSON.stringify(n)}`);if(y.includes(n.name))throw new Error(`${o.reserved_name}: ${n.name}`);if(r.push(n.name),w(n.component)&&!n.label)throw new Error(`${o.no_label}: ${JSON.stringify(n)}`);if(!n.schema)throw new Error(`${o.no_schema}: ${JSON.stringify(n)}`)}return r.flat()}function b(e){if(!Array.isArray(e))throw new TypeError(o.config_no_steps);return e.flatMap((r,n)=>{if(!r.children||!Array.isArray(r.children))throw new Error(`${o.no_children}: Step ${n}`);return r.children.flatMap(t=>c(t))})}function A(e){if(!e)throw new Error(o.config_no_config);if(!e.name)throw new Error(o.config_no_name);if(!["source","destination"].includes(e.type))throw new Error(o.config_no_type);if(!e.label)throw new Error(o.config_no_label);if(!e.docsLink)throw new Error(o.config_no_docs);if(!e.iconLink)throw new Error(o.config_no_icon);if(!e.steps)throw new Error(o.config_no_steps);if(e.stateSchema&&typeof e.stateSchema!="object")throw new Error(o.config_bad_state_schema);if(!e.auth)throw new Error(o.config_no_auth);if(!e.guide)throw new Error(o.config_no_guide);if(e.errorCodes&&typeof e.errorCodes!="object")throw new Error(o.config_bad_error_codes);const r=b(e.steps),n=E(r);if(n.length>0)throw new Error(`${o.duplicate_names}: ${n}`);return e}var l={REACT_APP_CLOUDQUERY_API_BASE_URL:"",REACT_APP_CLOUDQUERY_OAUTH_CONNECTOR_URL:"",REACT_APP_PLUGIN_TEAM:"cloudquery",REACT_APP_PLUGIN_KIND:"source",REACT_APP_PLUGIN_NAME:"datadog",REACT_APP_PLUGIN_VERSION:"development"};function T(){return{team:l.REACT_APP_PLUGIN_TEAM,kind:l.REACT_APP_PLUGIN_KIND,name:l.REACT_APP_PLUGIN_NAME,version:l.REACT_APP_PLUGIN_VERSION}}const d=i.createContext({config:{name:"",type:"source",label:"",docsLink:"",iconLink:"",steps:[],auth:[],stateSchema:void 0,guide:()=>u.jsx(u.Fragment,{}),errorCodes:{}},plugin:{name:"",kind:"",version:"",team:""},teamName:"",hideStepper:!1,tablesList:void 0,pluginUiMessageHandler:void 0,initialValues:void 0}),L=()=>i.useContext(d),N=({children:e,config:r,teamName:n,getTablesData:t,hideStepper:s,pluginUiMessageHandler:a,initialValues:p})=>{const[f,m]=i.useState();i.useEffect(()=>{t==null||t().then(({default:h})=>{m(P(h))})},[t]);const _=i.useMemo(()=>A(r),[r]),g=i.useMemo(()=>T(),[]);return u.jsx(d.Provider,{value:{config:_,plugin:g,teamName:n,tablesList:f,hideStepper:s,pluginUiMessageHandler:a,initialValues:p},children:e})};N.__docgenInfo={description:`Provider for shared/static plugin context.

@public`,methods:[],displayName:"PluginContextProvider",props:{config:{required:!0,tsType:{name:"PluginConfig"},description:""},teamName:{required:!0,tsType:{name:"string"},description:""},getTablesData:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<{ default: CloudQueryTables }>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"signature",type:"object",raw:"{ default: CloudQueryTables }",signature:{properties:[{key:"default",value:{name:"Array",elements:[{name:"CloudQueryTable"}],raw:"CloudQueryTable[]",required:!0}}]}}],raw:"Promise<{ default: CloudQueryTables }>"}}},description:""},hideStepper:{required:!0,tsType:{name:"boolean"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},pluginUiMessageHandler:{required:!0,tsType:{name:"any"},description:""},initialValues:{required:!1,tsType:{name:"union",raw:"FormMessagePayload['init']['initialValues'] | undefined",elements:[{name:"FormMessagePayload['init']['initialValues']",raw:"FormMessagePayload['init']['initialValues']"},{name:"undefined"}]},description:""}}};export{N as P,L as u};
